(function(N,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("react/jsx-runtime"),require("react-dom/client"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react-dom/client","react"],r):(N=typeof globalThis<"u"?globalThis:N||self,r(N.DeonPayElements={},N.ReactJSXRuntime,N.ReactDOM,N.React))})(this,function(N,r,k,C){"use strict";var De=Object.defineProperty;var _e=(N,r,k)=>r in N?De(N,r,{enumerable:!0,configurable:!0,writable:!0,value:k}):N[r]=k;var g=(N,r,k)=>_e(N,typeof r!="symbol"?r+"":r,k);function ve(d){let e=d.replace(/\D/g,"");if(e.length<13||e.length>19)return!1;let t=0,a=!1;for(let n=e.length-1;n>=0;n--){let l=parseInt(e[n],10);a&&(l*=2,l>9&&(l-=9)),t+=l,a=!a}return t%10===0}var V=[{brand:"visa",pattern:/^4/,lengths:[13,16,19],cvvLength:3,displayName:"Visa"},{brand:"mastercard",pattern:/^(5[1-5]|2[2-7])/,lengths:[16],cvvLength:3,displayName:"Mastercard"},{brand:"amex",pattern:/^3[47]/,lengths:[15],cvvLength:4,displayName:"American Express"},{brand:"discover",pattern:/^(6011|65|64[4-9]|622)/,lengths:[16,19],cvvLength:3,displayName:"Discover"},{brand:"diners",pattern:/^(36|38|30[0-5])/,lengths:[14,16,19],cvvLength:3,displayName:"Diners Club"},{brand:"jcb",pattern:/^35/,lengths:[16,19],cvvLength:3,displayName:"JCB"},{brand:"unionpay",pattern:/^62/,lengths:[16,17,18,19],cvvLength:3,displayName:"UnionPay"},{brand:"maestro",pattern:/^(5018|5020|5038|5893|6304|6759|6761|6762|6763)/,lengths:[12,13,14,15,16,17,18,19],cvvLength:3,displayName:"Maestro"}];function A(d){let e=d.replace(/\D/g,"");for(let{brand:t,pattern:a}of V)if(a.test(e))return t;return"unknown"}function j(d){return V.find(e=>e.brand===d)}function I(d){let e=d.replace(/\D/g,""),t=A(e);if(t==="unknown")return e.length>=13&&e.length<=19;let a=j(t);return a?a.lengths.includes(e.length):!1}function T(d,e=!0){let t=[],a=d.replace(/\D/g,"");if(a.length===0)return{isValid:!1,isPotentiallyValid:!0,brand:"unknown",errors:e?["El número de tarjeta es requerido"]:[]};let n=A(a);e&&(I(a)||t.push("El número de tarjeta tiene una longitud inválida")),e&&a.length>=13&&(ve(a)||t.push("El número de tarjeta es inválido"));let l=e&&t.length===0,o=!e||a.length<19&&n!=="unknown";return{isValid:l,isPotentiallyValid:o,brand:n,errors:t}}function O(d){let e=d.replace(/\D/g,"");return e.length>=13&&I(e)}function Z(d,e,t=!0){let a=[],n=typeof d=="string"?parseInt(d,10):d,l=typeof e=="string"?parseInt(e,10):e;if(isNaN(n))return t&&a.push("El mes de expiración es inválido"),{isValid:!1,isPotentiallyValid:!t,month:null,year:null,errors:a};if((n<1||n>12)&&a.push("El mes debe estar entre 01 y 12"),isNaN(l))return t&&a.push("El año de expiración es inválido"),{isValid:!1,isPotentiallyValid:!t,month:n,year:null,errors:a};let o=new Date().getFullYear(),s=Math.floor(o/100)*100,u=l;if(l<100&&(u=s+l,u<o&&(u+=100)),t){let E=new Date().getMonth()+1,S=new Date(u,n-1,1),L=new Date(o,E-1,1);S<L&&a.push("La tarjeta está expirada"),u>o+20&&a.push("El año de expiración es inválido")}let m=t&&a.length===0,y=!t||a.length===0;return{isValid:m,isPotentiallyValid:y,month:n,year:u,errors:a}}function U(d,e){let t=typeof d=="string"?parseInt(d,10):d,a=typeof e=="string"?parseInt(e,10):e;return!isNaN(t)&&!isNaN(a)&&t>0&&a>0}function W(d,e,t=!0){let a=[],n=d.replace(/\D/g,"");if(n.length===0)return{isValid:!1,isPotentiallyValid:!0,errors:t?["El código de seguridad es requerido"]:[]};let l=3;if(e){let u=A(e),m=j(u);m&&(l=m.cvvLength)}if(/\D/.test(d)&&a.push("El código de seguridad solo debe contener números"),t){if(n.length!==l){let u=l===4?"4 dígitos":"3 dígitos";a.push(`El código de seguridad debe tener ${u}`)}}else n.length>l&&a.push("El código de seguridad es demasiado largo");let o=t&&a.length===0,s=!t||n.length<=l&&a.length===0;return{isValid:o,isPotentiallyValid:s,errors:a}}function be(d){let e=A(d),t=j(e);return t?t.cvvLength:3}function K(d,e){let t=d.replace(/\D/g,""),a=e?be(e):3;return t.length===a}function we(d){let e=d.replace(/\D/g,""),t=A(e);return t==="amex"?e.replace(/(\d{4})(\d{6})(\d{5})/,"$1 $2 $3").trim().slice(0,17):t==="diners"?e.replace(/(\d{4})(\d{6})(\d{4})/,"$1 $2 $3").trim().slice(0,16):e.replace(/(\d{4})/g,"$1 ").trim().slice(0,23)}function xe(d){let e=d.replace(/\D/g,"");return e.length>=2?`${e.slice(0,2)}/${e.slice(2,4)}`:e}function X(d){let e=d.split("/");if(e.length!==2)return null;let t=parseInt(e[0],10),a=parseInt(e[1],10);if(isNaN(t)||isNaN(a))return null;let n=new Date().getFullYear(),l=Math.floor(n/100)*100,o=a<100?l+a:a;return{month:t,year:o}}const z=({brand:d,className:e=""})=>{const t=`deonpay-card-brand ${e}`;switch(d){case"visa":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#1434CB"}),r.jsx("path",{d:"M13.8 14.5L15.2 6.5H17L15.6 14.5H13.8Z",fill:"white"}),r.jsx("path",{d:"M21.5 6.7C21.1 6.5 20.5 6.3 19.7 6.3C17.9 6.3 16.7 7.2 16.7 8.5C16.7 9.5 17.7 10 18.4 10.3C19.2 10.6 19.5 10.8 19.5 11.1C19.5 11.6 18.9 11.8 18.3 11.8C17.5 11.8 17.1 11.7 16.4 11.4L16.1 11.3L15.8 13.1C16.3 13.3 17.2 13.5 18.1 13.5C20.1 13.5 21.2 12.6 21.2 11.2C21.2 10.4 20.7 9.8 19.6 9.3C18.9 9 18.5 8.8 18.5 8.4C18.5 8.1 18.8 7.8 19.6 7.8C20.3 7.8 20.8 7.9 21.2 8.1L21.4 8.2L21.5 6.7Z",fill:"white"}),r.jsx("path",{d:"M24.5 6.5H23.1C22.7 6.5 22.4 6.6 22.2 7L19.5 14.5H21.5L21.9 13.3H24.3L24.5 14.5H26.3L24.5 6.5ZM22.5 11.7L23.4 9.1L23.9 11.7H22.5Z",fill:"white"}),r.jsx("path",{d:"M11.5 6.5L9.6 12.2L9.4 11.2C9 9.9 7.8 8.5 6.5 7.8L8.1 14.5H10.2L13.6 6.5H11.5Z",fill:"white"}),r.jsx("path",{d:"M7.5 6.5H4.5L4.5 6.7C6.9 7.3 8.5 8.8 9.1 10.7L8.4 7C8.3 6.6 8 6.5 7.5 6.5Z",fill:"#FFA500"})]});case"mastercard":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#EB001B"}),r.jsx("circle",{cx:"12",cy:"10",r:"6",fill:"#FF5F00"}),r.jsx("circle",{cx:"20",cy:"10",r:"6",fill:"#F79E1B"}),r.jsx("path",{d:"M16 5.5C17.1 6.4 17.8 7.8 17.8 9.4C17.8 11 17.1 12.4 16 13.3C14.9 12.4 14.2 11 14.2 9.4C14.2 7.8 14.9 6.4 16 5.5Z",fill:"#FF5F00"})]});case"amex":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#006FCF"}),r.jsx("path",{d:"M8.5 8.5H10.5L9.5 6L8.5 8.5ZM11 10H8L7.5 11H6L8.5 5H10.5L13 11H11.5L11 10Z",fill:"white"}),r.jsx("path",{d:"M13.5 5H17V6.5H15V7.5H17V9H15V10.5H17V12H13.5V5Z",fill:"white"}),r.jsx("path",{d:"M17.5 5H19L20.5 8L22 5H23.5L21 10V12H19.5V10L17.5 5Z",fill:"white"})]});case"discover":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#FF6000"}),r.jsx("circle",{cx:"24",cy:"10",r:"8",fill:"#FFB000"})]});case"diners":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#0079BE"}),r.jsx("circle",{cx:"12",cy:"10",r:"5",fill:"white"}),r.jsx("circle",{cx:"20",cy:"10",r:"5",fill:"white"})]});case"jcb":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#0E4C96"}),r.jsx("rect",{x:"8",y:"6",width:"4",height:"8",fill:"#FF0000"}),r.jsx("rect",{x:"14",y:"6",width:"4",height:"8",fill:"#00A651"}),r.jsx("rect",{x:"20",y:"6",width:"4",height:"8",fill:"#0E4C96"})]});case"unionpay":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#E21836"}),r.jsx("circle",{cx:"10",cy:"10",r:"4",fill:"#00447C"}),r.jsx("circle",{cx:"22",cy:"10",r:"4",fill:"#007B84"})]});case"maestro":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#6C6C6C"}),r.jsx("circle",{cx:"12",cy:"10",r:"5",fill:"#EB001B"}),r.jsx("circle",{cx:"20",cy:"10",r:"5",fill:"#0099DF"})]});default:return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#E5E7EB"}),r.jsx("rect",{x:"4",y:"8",width:"8",height:"4",rx:"1",fill:"#9CA3AF"}),r.jsx("rect",{x:"14",y:"8",width:"14",height:"1.5",rx:"0.75",fill:"#D1D5DB"}),r.jsx("rect",{x:"14",y:"10.5",width:"10",height:"1.5",rx:"0.75",fill:"#D1D5DB"})]})}},J=({onChange:d,onReady:e,options:t={},appearance:a})=>{const{showCardholderName:n=!0}=t,l=C.useMemo(()=>{if(!(a!=null&&a.variables))return{};const f={};return Object.entries(a.variables).forEach(([h,c])=>{const p=`--dp-${h.replace(/([A-Z])/g,"-$1").toLowerCase()}`;f[p]=c}),f},[a]),[o,s]=C.useState({cardNumber:"",expiry:"",cvv:"",cardholderName:"",errors:{},touched:{cardNumber:!1,expiry:!1,cvv:!1,cardholderName:!1},isComplete:!1}),u=A(o.cardNumber);C.useEffect(()=>{const f=Object.keys(o.errors).length>0,h=O(o.cardNumber)&&U(o.expiry,"")&&K(o.cvv,o.cardNumber)&&(!n||o.cardholderName.length>0);d==null||d({complete:h&&!f,empty:!o.cardNumber&&!o.expiry&&!o.cvv,error:f?{type:"validation_error",message:Object.values(o.errors)[0]||""}:void 0})},[o,d,n]),C.useEffect(()=>{e==null||e()},[e]);const m=C.useCallback(f=>{const h=f.target.value.replace(/\s/g,""),c=we(h);s(p=>{const w={...p,cardNumber:c};if(p.touched.cardNumber){const D=T(h,O(h));w.errors={...p.errors,cardNumber:D.errors[0]},D.errors[0]||delete w.errors.cardNumber}return w})},[]),y=C.useCallback(f=>{const h=xe(f.target.value);s(c=>{const p={...c,expiry:h};if(c.touched.expiry){const w=X(h);if(w&&U(w.month,w.year)){const D=Z(w.month,w.year,!0);p.errors={...c.errors,expiry:D.errors[0]},D.errors[0]||delete p.errors.expiry}}return p})},[]),E=C.useCallback(f=>{const h=f.target.value.replace(/\D/g,"").slice(0,4);s(c=>{const p={...c,cvv:h};if(c.touched.cvv){const w=W(h,c.cardNumber,K(h,c.cardNumber));p.errors={...c.errors,cvv:w.errors[0]},w.errors[0]||delete p.errors.cvv}return p})},[]),S=C.useCallback(f=>{const h=f.target.value;s(c=>{const p={...c,cardholderName:h};return c.touched.cardholderName&&n&&(p.errors={...c.errors,cardholderName:h.length===0?"El nombre del titular es requerido":void 0},p.errors.cardholderName||delete p.errors.cardholderName),p})},[n]),L=C.useCallback(f=>{s(h=>{const c={...h,touched:{...h.touched,[f]:!0}};switch(f){case"cardNumber":{const p=String(h.cardNumber||"").replace(/\s/g,""),w=T(p,!0);c.errors={...h.errors,cardNumber:w.errors[0]},w.errors[0]||delete c.errors.cardNumber;break}case"expiry":{const p=X(h.expiry);if(p){const w=Z(p.month,p.year,!0);c.errors={...h.errors,expiry:w.errors[0]},w.errors[0]||delete c.errors.expiry}else c.errors={...h.errors,expiry:"La fecha de expiración es inválida"};break}case"cvv":{const p=W(h.cvv,h.cardNumber,!0);c.errors={...h.errors,cvv:p.errors[0]},p.errors[0]||delete c.errors.cvv;break}case"cardholderName":{n&&h.cardholderName.length===0&&(c.errors={...h.errors,cardholderName:"El nombre del titular es requerido"});break}}return c})},[n]);return r.jsxs("div",{className:"deonpay-payment-card",style:l,children:[r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-card-number",className:"deonpay-label",children:"Número de tarjeta"}),r.jsxs("div",{className:"deonpay-input-wrapper",children:[r.jsx("input",{id:"deonpay-card-number",type:"text",className:`deonpay-input has-icon ${o.errors.cardNumber&&o.touched.cardNumber?"error":""}`,placeholder:"1234 5678 9012 3456",value:o.cardNumber,onChange:m,onBlur:()=>L("cardNumber"),autoComplete:"cc-number",inputMode:"numeric"}),r.jsx("div",{className:"deonpay-input-icon",children:r.jsx(z,{brand:u})})]}),o.errors.cardNumber&&o.touched.cardNumber&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cardNumber})]}),r.jsxs("div",{className:"deonpay-row",children:[r.jsx("div",{className:"deonpay-col",children:r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-expiry",className:"deonpay-label",children:"Fecha de expiración"}),r.jsx("input",{id:"deonpay-expiry",type:"text",className:`deonpay-input ${o.errors.expiry&&o.touched.expiry?"error":""}`,placeholder:"MM/AA",value:o.expiry,onChange:y,onBlur:()=>L("expiry"),autoComplete:"cc-exp",inputMode:"numeric",maxLength:5}),o.errors.expiry&&o.touched.expiry&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.expiry})]})}),r.jsx("div",{className:"deonpay-col",children:r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-cvv",className:"deonpay-label",children:"CVV"}),r.jsx("input",{id:"deonpay-cvv",type:"text",className:`deonpay-input ${o.errors.cvv&&o.touched.cvv?"error":""}`,placeholder:"123",value:o.cvv,onChange:E,onBlur:()=>L("cvv"),autoComplete:"cc-csc",inputMode:"numeric",maxLength:4}),o.errors.cvv&&o.touched.cvv&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cvv})]})})]}),n&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-cardholder-name",className:"deonpay-label",children:"Nombre del titular"}),r.jsx("input",{id:"deonpay-cardholder-name",type:"text",className:`deonpay-input ${o.errors.cardholderName&&o.touched.cardholderName?"error":""}`,placeholder:"Nombre como aparece en la tarjeta",value:o.cardholderName,onChange:S,onBlur:()=>L("cardholderName"),autoComplete:"cc-name"}),o.errors.cardholderName&&o.touched.cardholderName&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cardholderName})]})]})},Y={"01000":{city:"Ciudad de México",state:"CDMX"},"03100":{city:"Ciudad de México",state:"CDMX"},"06600":{city:"Ciudad de México",state:"CDMX"},64e3:{city:"Monterrey",state:"Nuevo León"},44100:{city:"Guadalajara",state:"Jalisco"},2e4:{city:"Aguascalientes",state:"Aguascalientes"},76e3:{city:"Querétaro",state:"Querétaro"},78e3:{city:"San Luis Potosí",state:"San Luis Potosí"},8e4:{city:"Culiacán",state:"Sinaloa"},97e3:{city:"Mérida",state:"Yucatán"}},Ne=({onChange:d,onReady:e,appearance:t,options:a={}})=>{var te,re,ae,se,ne,oe,le,ie,de,ce,he,pe,ue,me,ye,ge;const{fields:n={},defaultValues:l={}}=a,o=C.useMemo(()=>{if(!(t!=null&&t.variables))return{};const i={};return Object.entries(t.variables).forEach(([v,b])=>{const x=`--dp-${v.replace(/([A-Z])/g,"-$1").toLowerCase()}`;i[x]=b}),i},[t]),[s,u]=C.useState({name:l.name||"",email:l.email||"",phone:l.phone||"",address:{line1:((te=l.address)==null?void 0:te.line1)||"",line2:((re=l.address)==null?void 0:re.line2)||"",city:((ae=l.address)==null?void 0:ae.city)||"",state:((se=l.address)==null?void 0:se.state)||"",postal_code:((ne=l.address)==null?void 0:ne.postal_code)||"",country:((oe=l.address)==null?void 0:oe.country)||"MX"},errors:{},touched:{name:!1,email:!1,phone:!1,address:{line1:!1,line2:!1,city:!1,state:!1,postal_code:!1,country:!1}},isComplete:!1}),[m,y]=C.useState(!1),[E,S]=C.useState(!1),L=n.name!=="never",f=n.email!=="never",h=n.phone!=="never",c=n.address&&Object.values(n.address).some(i=>i!=="never"),p=((le=n.address)==null?void 0:le.line1)!=="never",w=((ie=n.address)==null?void 0:ie.line2)!=="never",D=((de=n.address)==null?void 0:de.city)!=="never",$=((ce=n.address)==null?void 0:ce.state)!=="never",q=((he=n.address)==null?void 0:he.postal_code)!=="never",H=((pe=n.address)==null?void 0:pe.country)!=="never";C.useEffect(()=>{const i=Object.keys(s.errors).length>0,v=(!L||s.name.length>0)&&(!f||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email))&&(!p||s.address.line1.length>0)&&(!D||s.address.city.length>0)&&(!$||s.address.state.length>0)&&(!q||s.address.postal_code.length>0)&&(!H||s.address.country.length>0);d==null||d({complete:v&&!i,empty:!s.name&&!s.email&&!s.phone,error:i?{type:"validation_error",message:Object.values(s.errors)[0]||""}:void 0})},[s,d,L,f,p,D,$,q,H]),C.useEffect(()=>{e==null||e()},[e]);const ee=C.useCallback(async i=>{if(i.length===5&&/^\d+$/.test(i)){y(!0),S(!1);try{const v=new AbortController,b=setTimeout(()=>v.abort(),3e3),x=await fetch(`https://api-sepomex.hckdrk.mx/query/get_copomex_info?type=codigo_postal&codigo_postal=${i}`,{signal:v.signal});if(clearTimeout(b),x.ok){const B=await x.json();if(B&&B.length>0){const _=B[0];u(F=>({...F,address:{...F.address,city:_.response.municipio||_.response.ciudad||"",state:_.response.estado||"",country:"MX"}})),S(!0)}else{const _=Y[i];_&&(u(F=>({...F,address:{...F.address,city:_.city,state:_.state,country:"MX"}})),S(!0))}}}catch{const b=Y[i];b&&(u(x=>({...x,address:{...x.address,city:b.city,state:b.state,country:"MX"}})),S(!0))}finally{y(!1)}}else S(!1)},[]);C.useEffect(()=>{s.address.postal_code&&s.address.postal_code.length===5?ee(s.address.postal_code):S(!1)},[s.address.postal_code,ee]);const M=C.useCallback((i,v)=>{u(b=>{var _;const x={...b};if(i.startsWith("address.")){const F=i.split(".")[1];x.address={...b.address,[F]:v}}else x[i]=v;if(i.startsWith("address.")?(_=b.touched.address)==null?void 0:_[i.split(".")[1]]:b.touched[i]){if(i==="email"&&v.length>0)if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v))x.errors={...b.errors,email:"Email inválido"};else{const{email:fe,...Le}=b.errors;x.errors=Le}if((i==="name"||i==="address.line1"||i==="address.city")&&v.length===0)x.errors={...b.errors,[i]:"Este campo es requerido"};else if(v.length>0){const{[i]:F,...fe}=b.errors;x.errors=fe}}return x})},[]),P=C.useCallback(i=>{u(v=>{const b={...v};if(i.startsWith("address.")){const B=i.split(".")[1];b.touched={...v.touched,address:{...v.touched.address,[B]:!0}}}else b.touched={...v.touched,[i]:!0};const x=i.startsWith("address.")?v.address[i.split(".")[1]]:v[i];return i==="email"&&x&&x.length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x)||(b.errors={...v.errors,email:"Email inválido"})),(i==="name"||i==="address.line1"||i==="address.city")&&(!x||x.length===0)&&(b.errors={...v.errors,[i]:"Este campo es requerido"}),b})},[]);return r.jsxs("div",{className:"deonpay-billing-details",style:o,children:[L&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-name",className:"deonpay-label",children:"Nombre completo"}),r.jsx("input",{id:"deonpay-billing-name",type:"text",className:`deonpay-input ${s.errors.name&&s.touched.name?"error":""}`,placeholder:"Juan Pérez",value:s.name,onChange:i=>M("name",i.target.value),onBlur:()=>P("name"),autoComplete:"name"}),s.errors.name&&s.touched.name&&r.jsx("span",{className:"deonpay-error-message",children:s.errors.name})]}),f&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-email",className:"deonpay-label",children:"Email"}),r.jsx("input",{id:"deonpay-billing-email",type:"email",className:`deonpay-input ${s.errors.email&&s.touched.email?"error":""}`,placeholder:"juan@ejemplo.com",value:s.email,onChange:i=>M("email",i.target.value),onBlur:()=>P("email"),autoComplete:"email"}),s.errors.email&&s.touched.email&&r.jsx("span",{className:"deonpay-error-message",children:s.errors.email})]}),h&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-phone",className:"deonpay-label",children:"Teléfono"}),r.jsx("input",{id:"deonpay-billing-phone",type:"tel",className:`deonpay-input ${s.errors.phone&&s.touched.phone?"error":""}`,placeholder:"+52 55 1234 5678",value:s.phone,onChange:i=>M("phone",i.target.value),onBlur:()=>P("phone"),autoComplete:"tel"}),s.errors.phone&&s.touched.phone&&r.jsx("span",{className:"deonpay-error-message",children:s.errors.phone})]}),c&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{className:"deonpay-label",children:"Dirección"}),q&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsxs("div",{className:"deonpay-input-wrapper",children:[r.jsx("input",{id:"deonpay-billing-postal-code",type:"text",className:"deonpay-input",placeholder:"Código postal (ej: 64000)",value:s.address.postal_code,onChange:i=>M("address.postal_code",i.target.value),onBlur:()=>P("address.postal_code"),autoComplete:"postal-code",maxLength:5}),m&&r.jsx("div",{className:"deonpay-input-icon",children:r.jsx("div",{className:"deonpay-spinner"})}),E&&!m&&r.jsx("div",{className:"deonpay-input-icon",children:r.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),E&&r.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Dirección encontrada automáticamente"})]}),(D||$||H)&&r.jsx("div",{className:"deonpay-form-group",children:r.jsxs("div",{className:"deonpay-row",children:[D&&r.jsxs("div",{className:"deonpay-col",style:{flex:"1 1 45%",minWidth:"120px"},children:[r.jsx("input",{id:"deonpay-billing-city",type:"text",className:`deonpay-input ${s.errors["address.city"]&&((ue=s.touched.address)!=null&&ue.city)?"error":""}`,placeholder:"Ciudad",value:s.address.city,onChange:i=>M("address.city",i.target.value),onBlur:()=>P("address.city"),autoComplete:"address-level2",readOnly:E}),s.errors["address.city"]&&((me=s.touched.address)==null?void 0:me.city)&&r.jsx("span",{className:"deonpay-error-message",children:s.errors["address.city"]})]}),$&&r.jsx("div",{className:"deonpay-col",style:{flex:"1 1 45%",minWidth:"120px"},children:r.jsx("input",{id:"deonpay-billing-state",type:"text",className:"deonpay-input",placeholder:"Estado",value:s.address.state,onChange:i=>M("address.state",i.target.value),onBlur:()=>P("address.state"),autoComplete:"address-level1",readOnly:E})})]})}),H&&r.jsx("div",{className:"deonpay-form-group",children:r.jsxs("select",{id:"deonpay-billing-country",className:"deonpay-input",value:s.address.country,onChange:i=>M("address.country",i.target.value),onBlur:()=>P("address.country"),autoComplete:"country",disabled:E,children:[r.jsx("option",{value:"MX",children:"México"}),r.jsx("option",{value:"US",children:"Estados Unidos"}),r.jsx("option",{value:"CA",children:"Canadá"})]})}),p&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("input",{id:"deonpay-billing-address-line1",type:"text",className:`deonpay-input ${s.errors["address.line1"]&&((ye=s.touched.address)!=null&&ye.line1)?"error":""}`,placeholder:"Calle y número",value:s.address.line1,onChange:i=>M("address.line1",i.target.value),onBlur:()=>P("address.line1"),autoComplete:"address-line1"}),s.errors["address.line1"]&&((ge=s.touched.address)==null?void 0:ge.line1)&&r.jsx("span",{className:"deonpay-error-message",children:s.errors["address.line1"]})]}),w&&r.jsx("div",{className:"deonpay-form-group",children:r.jsx("input",{id:"deonpay-billing-address-line2",type:"text",className:"deonpay-input",placeholder:"Apartamento, suite, etc. (opcional)",value:s.address.line2,onChange:i=>M("address.line2",i.target.value),onBlur:()=>P("address.line2"),autoComplete:"address-line2"})})]})]})};class Q{constructor(e){g(this,"clientSecret");g(this,"appearance");g(this,"locale");g(this,"elements",new Map);this.clientSecret=e.clientSecret,this.appearance=e.appearance||{},this.locale=e.locale||"es"}create(e,t){if(e==="payment"){const a=new Ce(this,t);return this.elements.set(a.id,a),a}else if(e==="billing"){const a=new Ee(this,t);return this.elements.set(a.id,a),a}else throw new Error(`Unsupported element type: ${e}`)}getClientSecret(){return this.clientSecret}getAppearance(){return this.appearance}getLocale(){return this.locale}getElements(){return Array.from(this.elements.values())}async submit(){const e=this.getElements();await Promise.all(e.map(t=>{var a;return(a=t.submit)==null?void 0:a.call(t)}))}}class Ce{constructor(e,t={}){g(this,"id");g(this,"type","payment");g(this,"elements");g(this,"options");g(this,"container",null);g(this,"root",null);g(this,"eventHandlers",new Map);this.id=`payment-element-${Math.random().toString(36).substr(2,9)}`,this.elements=e,this.options=t}mount(e){if(this.container)throw new Error("Element already mounted");const t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error(`Element not found: ${e}`);this.container=t,this.render()}unmount(){if(this.root){try{this.root.unmount()}catch{}this.root=null}this.container&&(this.container=null)}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){var a;(a=this.eventHandlers.get(e))==null||a.delete(t)}emit(e,t){var a;(a=this.eventHandlers.get(e))==null||a.forEach(n=>n(t))}render(){var a;if(!this.container)return;this.container.classList.add("deonpay-elements");const e=this.elements.getAppearance().theme;e&&e!=="none"&&this.container.setAttribute("data-theme",e);const t=this.elements.getAppearance().variables;t&&Object.entries(t).forEach(([n,l])=>{const o=`--dp-${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`;this.container.style.setProperty(o,l)}),this.root=k.createRoot(this.container),this.root.render(r.jsx(J,{onChange:n=>this.emit("change",n),onReady:()=>this.emit("ready",{}),options:{showCardholderName:((a=this.options.fields)==null?void 0:a.billingDetails)!=="never"},appearance:this.elements.getAppearance()}))}getCardData(){if(!this.container)return null;const e=this.container.querySelector("#deonpay-card-number"),t=this.container.querySelector("#deonpay-expiry"),a=this.container.querySelector("#deonpay-cvv"),n=this.container.querySelector("#deonpay-cardholder-name");if(!e||!t||!a)return null;const l=e.value.replace(/\s/g,""),o=t.value.split("/"),s=a.value,u=n==null?void 0:n.value;return{number:l,exp_month:parseInt(o[0],10),exp_year:parseInt(o[1],10)+2e3,cvv:s,cardholder_name:u}}async submit(){if(!this.container)throw new Error("Element not mounted");this.container.querySelectorAll("input").forEach(t=>{t.dispatchEvent(new Event("blur",{bubbles:!0}))})}}class Ee{constructor(e,t={}){g(this,"id");g(this,"type","billing");g(this,"elements");g(this,"options");g(this,"container",null);g(this,"root",null);g(this,"eventHandlers",new Map);this.id=`billing-element-${Math.random().toString(36).substr(2,9)}`,this.elements=e,this.options=t}mount(e){if(this.container)throw new Error("Element already mounted");const t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error(`Element not found: ${e}`);this.container=t,this.render()}unmount(){if(this.root){try{this.root.unmount()}catch{}this.root=null}this.container&&(this.container=null)}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){var a;(a=this.eventHandlers.get(e))==null||a.delete(t)}emit(e,t){var a;(a=this.eventHandlers.get(e))==null||a.forEach(n=>n(t))}render(){if(!this.container)return;this.container.classList.add("deonpay-elements");const e=this.elements.getAppearance().theme;e&&e!=="none"&&this.container.setAttribute("data-theme",e);const t=this.elements.getAppearance().variables;t&&Object.entries(t).forEach(([a,n])=>{const l=`--dp-${a.replace(/([A-Z])/g,"-$1").toLowerCase()}`;this.container.style.setProperty(l,n)}),this.root=k.createRoot(this.container),this.root.render(r.jsx(Ne,{onChange:a=>this.emit("change",a),onReady:()=>this.emit("ready",{}),options:this.options,appearance:this.elements.getAppearance()}))}getBillingData(){if(!this.container)return null;const e=this.container.querySelector("#deonpay-billing-name"),t=this.container.querySelector("#deonpay-billing-email"),a=this.container.querySelector("#deonpay-billing-phone"),n=this.container.querySelector("#deonpay-billing-address-line1"),l=this.container.querySelector("#deonpay-billing-address-line2"),o=this.container.querySelector("#deonpay-billing-city"),s=this.container.querySelector("#deonpay-billing-state"),u=this.container.querySelector("#deonpay-billing-postal-code"),m=this.container.querySelector("#deonpay-billing-country");return{name:(e==null?void 0:e.value)||void 0,email:(t==null?void 0:t.value)||void 0,phone:(a==null?void 0:a.value)||void 0,address:{line1:(n==null?void 0:n.value)||void 0,line2:(l==null?void 0:l.value)||void 0,city:(o==null?void 0:o.value)||void 0,state:(s==null?void 0:s.value)||void 0,postal_code:(u==null?void 0:u.value)||void 0,country:(m==null?void 0:m.value)||void 0}}}async submit(){if(!this.container)throw new Error("Element not mounted");this.container.querySelectorAll("input, select").forEach(t=>{t.dispatchEvent(new Event("blur",{bubbles:!0}))})}}class Se{constructor(e,t="https://api.deonpay.mx"){g(this,"apiUrl");g(this,"publicKey");this.publicKey=e,this.apiUrl=t}async createToken(e){const t=`${this.apiUrl}/api/v1/elements/tokens`,a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify(e)}),n=await a.json();if(!a.ok){const l=n.error||{message:"Failed to create token"};throw new Error(l.message)}return n.token}}class G{constructor(e,t={}){g(this,"publicKey");g(this,"config");g(this,"tokenAPI");if(!e)throw new Error("DeonPay: publicKey is required");if(!e.startsWith("pk_"))throw new Error('DeonPay: Invalid public key format. Must start with "pk_"');this.publicKey=e,this.config={apiUrl:t.apiUrl||"https://api.deonpay.mx",locale:t.locale||"es"},this.tokenAPI=new Se(this.publicKey,this.config.apiUrl)}elements(e){if(!e.clientSecret)throw new Error("DeonPay: clientSecret is required");return new Q({...e,locale:e.locale||this.config.locale})}async confirmPayment(e){var l,o;const{elements:t,confirmParams:a,redirect:n="if_required"}=e;try{const s=t.getElements(),u=s.find(c=>c.type==="payment"),m=s.find(c=>c.type==="billing");if(!u)throw new Error("No payment element found");await t.submit();const y=u.getCardData();if(!y||!y.number||!y.exp_month||!y.exp_year||!y.cvv)throw new Error("Información de la tarjeta incompleta");let E;if(m){const c=m.getBillingData();c&&(E={name:c.name||y.cardholder_name||void 0,email:c.email||void 0,phone:c.phone||void 0,address:c.address||void 0})}else y.cardholder_name&&(E={name:y.cardholder_name});const S=await this.tokenAPI.createToken({card:{number:y.number,exp_month:y.exp_month,exp_year:y.exp_year,cvv:y.cvv},billing_details:E}),L=t.getClientSecret(),f=this.extractPaymentIntentId(L),h=await this.confirmPaymentIntentWithToken(f,S.id,E,a==null?void 0:a.return_url);if(h.status==="requires_action"&&h.next_action){if(n==="if_required"){const c=(l=h.next_action.redirect_to_url)==null?void 0:l.url;if(c)try{const p=await this.handle3DSChallenge(c);return{paymentIntent:await this.completeAuthentication(f,p.PaRes,p.MD)}}catch(p){return{error:{type:"authentication_error",message:p.message||"3DS authentication failed"}}}}else if(n==="always"){const c=(o=h.next_action.redirect_to_url)==null?void 0:o.url;c&&(window.location.href=c)}}return{paymentIntent:h}}catch(s){return{error:{type:"api_error",message:s.message||"Failed to confirm payment"}}}}async confirmPaymentIntentWithToken(e,t,a,n){var u;const l=`${this.config.apiUrl}/api/v1/payment_intents/${e}/confirm`,o=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify({payment_method:t,billing_details:a,return_url:n})}),s=await o.json();if(!o.ok)throw new Error(((u=s.error)==null?void 0:u.message)||"Failed to confirm payment");return s}extractPaymentIntentId(e){const t=e.split("_secret_");if(t.length!==2)throw new Error("Invalid client secret format");return t[0]}async handle3DSChallenge(e){return new Promise((t,a)=>{const n=document.createElement("div");n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999999;
      `;const l=document.createElement("div");l.style.cssText=`
        background: white;
        border-radius: 8px;
        padding: 20px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow: hidden;
        position: relative;
      `;const o=document.createElement("button");o.textContent="×",o.style.cssText=`
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        z-index: 1;
      `,o.onclick=()=>{document.body.removeChild(n),a(new Error("3DS authentication cancelled by user"))};const s=document.createElement("iframe");s.src=e,s.style.cssText=`
        width: 100%;
        height: 500px;
        border: none;
        border-radius: 4px;
      `;const u=m=>{m.data&&m.data.type==="3ds_complete"&&(window.removeEventListener("message",u),document.body.removeChild(n),t({PaRes:m.data.PaRes,MD:m.data.MD}))};window.addEventListener("message",u),s.addEventListener("load",()=>{var m;try{const y=s.contentDocument||((m=s.contentWindow)==null?void 0:m.document);if(y){const E=y.querySelector('input[name="PaRes"]'),S=y.querySelector('input[name="MD"]');E&&E.value&&(window.removeEventListener("message",u),document.body.removeChild(n),t({PaRes:E.value,MD:S==null?void 0:S.value}))}}catch{}}),l.appendChild(o),l.appendChild(s),n.appendChild(l),document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&(window.removeEventListener("message",u),document.body.removeChild(n),a(new Error("3DS authentication timed out")))},5*60*1e3)})}async completeAuthentication(e,t,a){var s;const n=`${this.config.apiUrl}/api/v1/payment_intents/${e}/complete_authentication`,l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify({authentication_result:t,MD:a})}),o=await l.json();if(!l.ok)throw new Error(((s=o.error)==null?void 0:s.message)||"Failed to complete authentication");return o}getPublicKey(){return this.publicKey}getConfig(){return this.config}}function R(d,e){return new G(d,e)}N.CardBrandIcon=z,N.DeonPay=R,N.DeonPayClass=G,N.Elements=Q,N.PaymentCard=J,N.default=R,Object.defineProperties(N,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=deonpay-elements.js.map
