"use strict";var fe=Object.defineProperty;var ve=(i,e,t)=>e in i?fe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var g=(i,e,t)=>ve(i,typeof e!="symbol"?e+"":e,t);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("react/jsx-runtime"),ce=require("react-dom/client"),N=require("react");function be(i){let e=i.replace(/\D/g,"");if(e.length<13||e.length>19)return!1;let t=0,s=!1;for(let n=e.length-1;n>=0;n--){let l=parseInt(e[n],10);s&&(l*=2,l>9&&(l-=9)),t+=l,s=!s}return t%10===0}var de=[{brand:"visa",pattern:/^4/,lengths:[13,16,19],cvvLength:3,displayName:"Visa"},{brand:"mastercard",pattern:/^(5[1-5]|2[2-7])/,lengths:[16],cvvLength:3,displayName:"Mastercard"},{brand:"amex",pattern:/^3[47]/,lengths:[15],cvvLength:4,displayName:"American Express"},{brand:"discover",pattern:/^(6011|65|64[4-9]|622)/,lengths:[16,19],cvvLength:3,displayName:"Discover"},{brand:"diners",pattern:/^(36|38|30[0-5])/,lengths:[14,16,19],cvvLength:3,displayName:"Diners Club"},{brand:"jcb",pattern:/^35/,lengths:[16,19],cvvLength:3,displayName:"JCB"},{brand:"unionpay",pattern:/^62/,lengths:[16,17,18,19],cvvLength:3,displayName:"UnionPay"},{brand:"maestro",pattern:/^(5018|5020|5038|5893|6304|6759|6761|6762|6763)/,lengths:[12,13,14,15,16,17,18,19],cvvLength:3,displayName:"Maestro"}];function P(i){let e=i.replace(/\D/g,"");for(let{brand:t,pattern:s}of de)if(s.test(e))return t;return"unknown"}function $(i){return de.find(e=>e.brand===i)}function he(i){let e=i.replace(/\D/g,""),t=P(e);if(t==="unknown")return e.length>=13&&e.length<=19;let s=$(t);return s?s.lengths.includes(e.length):!1}function te(i,e=!0){let t=[],s=i.replace(/\D/g,"");if(s.length===0)return{isValid:!1,isPotentiallyValid:!0,brand:"unknown",errors:e?["El número de tarjeta es requerido"]:[]};let n=P(s);e&&(he(s)||t.push("El número de tarjeta tiene una longitud inválida")),e&&s.length>=13&&(be(s)||t.push("El número de tarjeta es inválido"));let l=e&&t.length===0,o=!e||s.length<19&&n!=="unknown";return{isValid:l,isPotentiallyValid:o,brand:n,errors:t}}function re(i){let e=i.replace(/\D/g,"");return e.length>=13&&he(e)}function se(i,e,t=!0){let s=[],n=typeof i=="string"?parseInt(i,10):i,l=typeof e=="string"?parseInt(e,10):e;if(isNaN(n))return t&&s.push("El mes de expiración es inválido"),{isValid:!1,isPotentiallyValid:!t,month:null,year:null,errors:s};if((n<1||n>12)&&s.push("El mes debe estar entre 01 y 12"),isNaN(l))return t&&s.push("El año de expiración es inválido"),{isValid:!1,isPotentiallyValid:!t,month:n,year:null,errors:s};let o=new Date().getFullYear(),a=Math.floor(o/100)*100,m=l;if(l<100&&(m=a+l,m<o&&(m+=100)),t){let j=new Date().getMonth()+1,C=new Date(m,n-1,1),E=new Date(o,j-1,1);C<E&&s.push("La tarjeta está expirada"),m>o+20&&s.push("El año de expiración es inválido")}let p=t&&s.length===0,y=!t||s.length===0;return{isValid:p,isPotentiallyValid:y,month:n,year:m,errors:s}}function ae(i,e){let t=typeof i=="string"?parseInt(i,10):i,s=typeof e=="string"?parseInt(e,10):e;return!isNaN(t)&&!isNaN(s)&&t>0&&s>0}function ne(i,e,t=!0){let s=[],n=i.replace(/\D/g,"");if(n.length===0)return{isValid:!1,isPotentiallyValid:!0,errors:t?["El código de seguridad es requerido"]:[]};let l=3;if(e){let m=P(e),p=$(m);p&&(l=p.cvvLength)}if(/\D/.test(i)&&s.push("El código de seguridad solo debe contener números"),t){if(n.length!==l){let m=l===4?"4 dígitos":"3 dígitos";s.push(`El código de seguridad debe tener ${m}`)}}else n.length>l&&s.push("El código de seguridad es demasiado largo");let o=t&&s.length===0,a=!t||n.length<=l&&s.length===0;return{isValid:o,isPotentiallyValid:a,errors:s}}function we(i){let e=P(i),t=$(e);return t?t.cvvLength:3}function oe(i,e){let t=i.replace(/\D/g,""),s=e?we(e):3;return t.length===s}function Ne(i){let e=i.replace(/\D/g,""),t=P(e);return t==="amex"?e.replace(/(\d{4})(\d{6})(\d{5})/,"$1 $2 $3").trim().slice(0,17):t==="diners"?e.replace(/(\d{4})(\d{6})(\d{4})/,"$1 $2 $3").trim().slice(0,16):e.replace(/(\d{4})/g,"$1 ").trim().slice(0,23)}function je(i){let e=i.replace(/\D/g,"");return e.length>=2?`${e.slice(0,2)}/${e.slice(2,4)}`:e}function ie(i){let e=i.split("/");if(e.length!==2)return null;let t=parseInt(e[0],10),s=parseInt(e[1],10);if(isNaN(t)||isNaN(s))return null;let n=new Date().getFullYear(),l=Math.floor(n/100)*100,o=s<100?l+s:s;return{month:t,year:o}}const ue=({brand:i,className:e=""})=>{const t=`deonpay-card-brand ${e}`;switch(i){case"visa":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#1434CB"}),r.jsx("path",{d:"M13.8 14.5L15.2 6.5H17L15.6 14.5H13.8Z",fill:"white"}),r.jsx("path",{d:"M21.5 6.7C21.1 6.5 20.5 6.3 19.7 6.3C17.9 6.3 16.7 7.2 16.7 8.5C16.7 9.5 17.7 10 18.4 10.3C19.2 10.6 19.5 10.8 19.5 11.1C19.5 11.6 18.9 11.8 18.3 11.8C17.5 11.8 17.1 11.7 16.4 11.4L16.1 11.3L15.8 13.1C16.3 13.3 17.2 13.5 18.1 13.5C20.1 13.5 21.2 12.6 21.2 11.2C21.2 10.4 20.7 9.8 19.6 9.3C18.9 9 18.5 8.8 18.5 8.4C18.5 8.1 18.8 7.8 19.6 7.8C20.3 7.8 20.8 7.9 21.2 8.1L21.4 8.2L21.5 6.7Z",fill:"white"}),r.jsx("path",{d:"M24.5 6.5H23.1C22.7 6.5 22.4 6.6 22.2 7L19.5 14.5H21.5L21.9 13.3H24.3L24.5 14.5H26.3L24.5 6.5ZM22.5 11.7L23.4 9.1L23.9 11.7H22.5Z",fill:"white"}),r.jsx("path",{d:"M11.5 6.5L9.6 12.2L9.4 11.2C9 9.9 7.8 8.5 6.5 7.8L8.1 14.5H10.2L13.6 6.5H11.5Z",fill:"white"}),r.jsx("path",{d:"M7.5 6.5H4.5L4.5 6.7C6.9 7.3 8.5 8.8 9.1 10.7L8.4 7C8.3 6.6 8 6.5 7.5 6.5Z",fill:"#FFA500"})]});case"mastercard":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#EB001B"}),r.jsx("circle",{cx:"12",cy:"10",r:"6",fill:"#FF5F00"}),r.jsx("circle",{cx:"20",cy:"10",r:"6",fill:"#F79E1B"}),r.jsx("path",{d:"M16 5.5C17.1 6.4 17.8 7.8 17.8 9.4C17.8 11 17.1 12.4 16 13.3C14.9 12.4 14.2 11 14.2 9.4C14.2 7.8 14.9 6.4 16 5.5Z",fill:"#FF5F00"})]});case"amex":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#006FCF"}),r.jsx("path",{d:"M8.5 8.5H10.5L9.5 6L8.5 8.5ZM11 10H8L7.5 11H6L8.5 5H10.5L13 11H11.5L11 10Z",fill:"white"}),r.jsx("path",{d:"M13.5 5H17V6.5H15V7.5H17V9H15V10.5H17V12H13.5V5Z",fill:"white"}),r.jsx("path",{d:"M17.5 5H19L20.5 8L22 5H23.5L21 10V12H19.5V10L17.5 5Z",fill:"white"})]});case"discover":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#FF6000"}),r.jsx("circle",{cx:"24",cy:"10",r:"8",fill:"#FFB000"})]});case"diners":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#0079BE"}),r.jsx("circle",{cx:"12",cy:"10",r:"5",fill:"white"}),r.jsx("circle",{cx:"20",cy:"10",r:"5",fill:"white"})]});case"jcb":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#0E4C96"}),r.jsx("rect",{x:"8",y:"6",width:"4",height:"8",fill:"#FF0000"}),r.jsx("rect",{x:"14",y:"6",width:"4",height:"8",fill:"#00A651"}),r.jsx("rect",{x:"20",y:"6",width:"4",height:"8",fill:"#0E4C96"})]});case"unionpay":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#E21836"}),r.jsx("circle",{cx:"10",cy:"10",r:"4",fill:"#00447C"}),r.jsx("circle",{cx:"22",cy:"10",r:"4",fill:"#007B84"})]});case"maestro":return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#6C6C6C"}),r.jsx("circle",{cx:"12",cy:"10",r:"5",fill:"#EB001B"}),r.jsx("circle",{cx:"20",cy:"10",r:"5",fill:"#0099DF"})]});default:return r.jsxs("svg",{className:t,width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[r.jsx("rect",{width:"32",height:"20",rx:"2",fill:"#E5E7EB"}),r.jsx("rect",{x:"4",y:"8",width:"8",height:"4",rx:"1",fill:"#9CA3AF"}),r.jsx("rect",{x:"14",y:"8",width:"14",height:"1.5",rx:"0.75",fill:"#D1D5DB"}),r.jsx("rect",{x:"14",y:"10.5",width:"10",height:"1.5",rx:"0.75",fill:"#D1D5DB"})]})}},me=({onChange:i,onReady:e,options:t={},appearance:s})=>{const{showCardholderName:n=!0}=t,l=N.useMemo(()=>{if(!(s!=null&&s.variables))return{};const x={};return Object.entries(s.variables).forEach(([h,d])=>{const u=`--dp-${h.replace(/([A-Z])/g,"-$1").toLowerCase()}`;x[u]=d}),x},[s]),[o,a]=N.useState({cardNumber:"",expiry:"",cvv:"",cardholderName:"",errors:{},touched:{cardNumber:!1,expiry:!1,cvv:!1,cardholderName:!1},isComplete:!1}),m=P(o.cardNumber);N.useEffect(()=>{const x=Object.keys(o.errors).length>0,h=re(o.cardNumber)&&ae(o.expiry,"")&&oe(o.cvv,o.cardNumber)&&(!n||o.cardholderName.length>0);i==null||i({complete:h&&!x,empty:!o.cardNumber&&!o.expiry&&!o.cvv,error:x?{type:"validation_error",message:Object.values(o.errors)[0]||""}:void 0})},[o,i,n]),N.useEffect(()=>{e==null||e()},[e]);const p=N.useCallback(x=>{const h=x.target.value.replace(/\s/g,""),d=Ne(h);a(u=>{const b={...u,cardNumber:d};if(u.touched.cardNumber){const L=te(h,re(h));b.errors={...u.errors,cardNumber:L.errors[0]},L.errors[0]||delete b.errors.cardNumber}return b})},[]),y=N.useCallback(x=>{const h=je(x.target.value);a(d=>{const u={...d,expiry:h};if(d.touched.expiry){const b=ie(h);if(b&&ae(b.month,b.year)){const L=se(b.month,b.year,!0);u.errors={...d.errors,expiry:L.errors[0]},L.errors[0]||delete u.errors.expiry}}return u})},[]),j=N.useCallback(x=>{const h=x.target.value.replace(/\D/g,"").slice(0,4);a(d=>{const u={...d,cvv:h};if(d.touched.cvv){const b=ne(h,d.cardNumber,oe(h,d.cardNumber));u.errors={...d.errors,cvv:b.errors[0]},b.errors[0]||delete u.errors.cvv}return u})},[]),C=N.useCallback(x=>{const h=x.target.value;a(d=>{const u={...d,cardholderName:h};return d.touched.cardholderName&&n&&(u.errors={...d.errors,cardholderName:h.length===0?"El nombre del titular es requerido":void 0},u.errors.cardholderName||delete u.errors.cardholderName),u})},[n]),E=N.useCallback(x=>{a(h=>{const d={...h,touched:{...h.touched,[x]:!0}};switch(x){case"cardNumber":{const u=String(h.cardNumber||"").replace(/\s/g,""),b=te(u,!0);d.errors={...h.errors,cardNumber:b.errors[0]},b.errors[0]||delete d.errors.cardNumber;break}case"expiry":{const u=ie(h.expiry);if(u){const b=se(u.month,u.year,!0);d.errors={...h.errors,expiry:b.errors[0]},b.errors[0]||delete d.errors.expiry}else d.errors={...h.errors,expiry:"La fecha de expiración es inválida"};break}case"cvv":{const u=ne(h.cvv,h.cardNumber,!0);d.errors={...h.errors,cvv:u.errors[0]},u.errors[0]||delete d.errors.cvv;break}case"cardholderName":{n&&h.cardholderName.length===0&&(d.errors={...h.errors,cardholderName:"El nombre del titular es requerido"});break}}return d})},[n]);return r.jsxs("div",{className:"deonpay-payment-card",style:l,children:[r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-card-number",className:"deonpay-label",children:"Número de tarjeta"}),r.jsxs("div",{className:"deonpay-input-wrapper",children:[r.jsx("input",{id:"deonpay-card-number",type:"text",className:`deonpay-input has-icon ${o.errors.cardNumber&&o.touched.cardNumber?"error":""}`,placeholder:"1234 5678 9012 3456",value:o.cardNumber,onChange:p,onBlur:()=>E("cardNumber"),autoComplete:"cc-number",inputMode:"numeric"}),r.jsx("div",{className:"deonpay-input-icon",children:r.jsx(ue,{brand:m})})]}),o.errors.cardNumber&&o.touched.cardNumber&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cardNumber})]}),r.jsxs("div",{className:"deonpay-row",children:[r.jsx("div",{className:"deonpay-col",children:r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-expiry",className:"deonpay-label",children:"Fecha de expiración"}),r.jsx("input",{id:"deonpay-expiry",type:"text",className:`deonpay-input ${o.errors.expiry&&o.touched.expiry?"error":""}`,placeholder:"MM/AA",value:o.expiry,onChange:y,onBlur:()=>E("expiry"),autoComplete:"cc-exp",inputMode:"numeric",maxLength:5}),o.errors.expiry&&o.touched.expiry&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.expiry})]})}),r.jsx("div",{className:"deonpay-col",children:r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-cvv",className:"deonpay-label",children:"CVV"}),r.jsx("input",{id:"deonpay-cvv",type:"text",className:`deonpay-input ${o.errors.cvv&&o.touched.cvv?"error":""}`,placeholder:"123",value:o.cvv,onChange:j,onBlur:()=>E("cvv"),autoComplete:"cc-csc",inputMode:"numeric",maxLength:4}),o.errors.cvv&&o.touched.cvv&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cvv})]})})]}),n&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-cardholder-name",className:"deonpay-label",children:"Nombre del titular"}),r.jsx("input",{id:"deonpay-cardholder-name",type:"text",className:`deonpay-input ${o.errors.cardholderName&&o.touched.cardholderName?"error":""}`,placeholder:"Nombre como aparece en la tarjeta",value:o.cardholderName,onChange:C,onBlur:()=>E("cardholderName"),autoComplete:"cc-name"}),o.errors.cardholderName&&o.touched.cardholderName&&r.jsx("span",{className:"deonpay-error-message",children:o.errors.cardholderName})]})]})},le={"01000":{city:"Ciudad de México",state:"CDMX"},"03100":{city:"Ciudad de México",state:"CDMX"},"06600":{city:"Ciudad de México",state:"CDMX"},64e3:{city:"Monterrey",state:"Nuevo León"},44100:{city:"Guadalajara",state:"Jalisco"},2e4:{city:"Aguascalientes",state:"Aguascalientes"},76e3:{city:"Querétaro",state:"Querétaro"},78e3:{city:"San Luis Potosí",state:"San Luis Potosí"},8e4:{city:"Culiacán",state:"Sinaloa"},97e3:{city:"Mérida",state:"Yucatán"}},Ce=({onChange:i,onReady:e,appearance:t,options:s={}})=>{var q,V,I,O,T,Z,U,W,K,X,z,J,R,Y,Q,G;const{fields:n={},defaultValues:l={}}=s,o=N.useMemo(()=>{if(!(t!=null&&t.variables))return{};const c={};return Object.entries(t.variables).forEach(([f,v])=>{const w=`--dp-${f.replace(/([A-Z])/g,"-$1").toLowerCase()}`;c[w]=v}),c},[t]),[a,m]=N.useState({name:l.name||"",email:l.email||"",phone:l.phone||"",address:{line1:((q=l.address)==null?void 0:q.line1)||"",line2:((V=l.address)==null?void 0:V.line2)||"",city:((I=l.address)==null?void 0:I.city)||"",state:((O=l.address)==null?void 0:O.state)||"",postal_code:((T=l.address)==null?void 0:T.postal_code)||"",country:((Z=l.address)==null?void 0:Z.country)||"MX"},errors:{},touched:{name:!1,email:!1,phone:!1,address:{line1:!1,line2:!1,city:!1,state:!1,postal_code:!1,country:!1}},isComplete:!1}),[p,y]=N.useState(!1),[j,C]=N.useState(!1),E=n.name!=="never",x=n.email!=="never",h=n.phone!=="never",d=n.address&&Object.values(n.address).some(c=>c!=="never"),u=((U=n.address)==null?void 0:U.line1)!=="never",b=((W=n.address)==null?void 0:W.line2)!=="never",L=((K=n.address)==null?void 0:K.city)!=="never",k=((X=n.address)==null?void 0:X.state)!=="never",A=((z=n.address)==null?void 0:z.postal_code)!=="never",B=((J=n.address)==null?void 0:J.country)!=="never";N.useEffect(()=>{const c=Object.keys(a.errors).length>0,f=(!E||a.name.length>0)&&(!x||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email))&&(!u||a.address.line1.length>0)&&(!L||a.address.city.length>0)&&(!k||a.address.state.length>0)&&(!A||a.address.postal_code.length>0)&&(!B||a.address.country.length>0);i==null||i({complete:f&&!c,empty:!a.name&&!a.email&&!a.phone,error:c?{type:"validation_error",message:Object.values(a.errors)[0]||""}:void 0})},[a,i,E,x,u,L,k,A,B]),N.useEffect(()=>{e==null||e()},[e]);const H=N.useCallback(async c=>{if(c.length===5&&/^\d+$/.test(c)){y(!0),C(!1);try{const f=new AbortController,v=setTimeout(()=>f.abort(),3e3),w=await fetch(`https://api-sepomex.hckdrk.mx/query/get_copomex_info?type=codigo_postal&codigo_postal=${c}`,{signal:f.signal});if(clearTimeout(v),w.ok){const F=await w.json();if(F&&F.length>0){const S=F[0];m(M=>({...M,address:{...M.address,city:S.response.municipio||S.response.ciudad||"",state:S.response.estado||"",country:"MX"}})),C(!0)}else{const S=le[c];S&&(m(M=>({...M,address:{...M.address,city:S.city,state:S.state,country:"MX"}})),C(!0))}}}catch{const v=le[c];v&&(m(w=>({...w,address:{...w.address,city:v.city,state:v.state,country:"MX"}})),C(!0))}finally{y(!1)}}else C(!1)},[]);N.useEffect(()=>{a.address.postal_code&&a.address.postal_code.length===5?H(a.address.postal_code):C(!1)},[a.address.postal_code,H]);const _=N.useCallback((c,f)=>{m(v=>{var S;const w={...v};if(c.startsWith("address.")){const M=c.split(".")[1];w.address={...v.address,[M]:f}}else w[c]=f;if(c.startsWith("address.")?(S=v.touched.address)==null?void 0:S[c.split(".")[1]]:v.touched[c]){if(c==="email"&&f.length>0)if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f))w.errors={...v.errors,email:"Email inválido"};else{const{email:ee,...xe}=v.errors;w.errors=xe}if((c==="name"||c==="address.line1"||c==="address.city")&&f.length===0)w.errors={...v.errors,[c]:"Este campo es requerido"};else if(f.length>0){const{[c]:M,...ee}=v.errors;w.errors=ee}}return w})},[]),D=N.useCallback(c=>{m(f=>{const v={...f};if(c.startsWith("address.")){const F=c.split(".")[1];v.touched={...f.touched,address:{...f.touched.address,[F]:!0}}}else v.touched={...f.touched,[c]:!0};const w=c.startsWith("address.")?f.address[c.split(".")[1]]:f[c];return c==="email"&&w&&w.length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w)||(v.errors={...f.errors,email:"Email inválido"})),(c==="name"||c==="address.line1"||c==="address.city")&&(!w||w.length===0)&&(v.errors={...f.errors,[c]:"Este campo es requerido"}),v})},[]);return r.jsxs("div",{className:"deonpay-billing-details",style:o,children:[E&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-name",className:"deonpay-label",children:"Nombre completo"}),r.jsx("input",{id:"deonpay-billing-name",type:"text",className:`deonpay-input ${a.errors.name&&a.touched.name?"error":""}`,placeholder:"Juan Pérez",value:a.name,onChange:c=>_("name",c.target.value),onBlur:()=>D("name"),autoComplete:"name"}),a.errors.name&&a.touched.name&&r.jsx("span",{className:"deonpay-error-message",children:a.errors.name})]}),x&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-email",className:"deonpay-label",children:"Email"}),r.jsx("input",{id:"deonpay-billing-email",type:"email",className:`deonpay-input ${a.errors.email&&a.touched.email?"error":""}`,placeholder:"juan@ejemplo.com",value:a.email,onChange:c=>_("email",c.target.value),onBlur:()=>D("email"),autoComplete:"email"}),a.errors.email&&a.touched.email&&r.jsx("span",{className:"deonpay-error-message",children:a.errors.email})]}),h&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{htmlFor:"deonpay-billing-phone",className:"deonpay-label",children:"Teléfono"}),r.jsx("input",{id:"deonpay-billing-phone",type:"tel",className:`deonpay-input ${a.errors.phone&&a.touched.phone?"error":""}`,placeholder:"+52 55 1234 5678",value:a.phone,onChange:c=>_("phone",c.target.value),onBlur:()=>D("phone"),autoComplete:"tel"}),a.errors.phone&&a.touched.phone&&r.jsx("span",{className:"deonpay-error-message",children:a.errors.phone})]}),d&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("label",{className:"deonpay-label",children:"Dirección"}),A&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsxs("div",{className:"deonpay-input-wrapper",children:[r.jsx("input",{id:"deonpay-billing-postal-code",type:"text",className:"deonpay-input",placeholder:"Código postal (ej: 64000)",value:a.address.postal_code,onChange:c=>_("address.postal_code",c.target.value),onBlur:()=>D("address.postal_code"),autoComplete:"postal-code",maxLength:5}),p&&r.jsx("div",{className:"deonpay-input-icon",children:r.jsx("div",{className:"deonpay-spinner"})}),j&&!p&&r.jsx("div",{className:"deonpay-input-icon",children:r.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),j&&r.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Dirección encontrada automáticamente"})]}),(L||k||B)&&r.jsx("div",{className:"deonpay-form-group",children:r.jsxs("div",{className:"deonpay-row",children:[L&&r.jsxs("div",{className:"deonpay-col",style:{flex:"1 1 45%",minWidth:"120px"},children:[r.jsx("input",{id:"deonpay-billing-city",type:"text",className:`deonpay-input ${a.errors["address.city"]&&((R=a.touched.address)!=null&&R.city)?"error":""}`,placeholder:"Ciudad",value:a.address.city,onChange:c=>_("address.city",c.target.value),onBlur:()=>D("address.city"),autoComplete:"address-level2",readOnly:j}),a.errors["address.city"]&&((Y=a.touched.address)==null?void 0:Y.city)&&r.jsx("span",{className:"deonpay-error-message",children:a.errors["address.city"]})]}),k&&r.jsx("div",{className:"deonpay-col",style:{flex:"1 1 45%",minWidth:"120px"},children:r.jsx("input",{id:"deonpay-billing-state",type:"text",className:"deonpay-input",placeholder:"Estado",value:a.address.state,onChange:c=>_("address.state",c.target.value),onBlur:()=>D("address.state"),autoComplete:"address-level1",readOnly:j})})]})}),B&&r.jsx("div",{className:"deonpay-form-group",children:r.jsxs("select",{id:"deonpay-billing-country",className:"deonpay-input",value:a.address.country,onChange:c=>_("address.country",c.target.value),onBlur:()=>D("address.country"),autoComplete:"country",disabled:j,children:[r.jsx("option",{value:"MX",children:"México"}),r.jsx("option",{value:"US",children:"Estados Unidos"}),r.jsx("option",{value:"CA",children:"Canadá"})]})}),u&&r.jsxs("div",{className:"deonpay-form-group",children:[r.jsx("input",{id:"deonpay-billing-address-line1",type:"text",className:`deonpay-input ${a.errors["address.line1"]&&((Q=a.touched.address)!=null&&Q.line1)?"error":""}`,placeholder:"Calle y número",value:a.address.line1,onChange:c=>_("address.line1",c.target.value),onBlur:()=>D("address.line1"),autoComplete:"address-line1"}),a.errors["address.line1"]&&((G=a.touched.address)==null?void 0:G.line1)&&r.jsx("span",{className:"deonpay-error-message",children:a.errors["address.line1"]})]}),b&&r.jsx("div",{className:"deonpay-form-group",children:r.jsx("input",{id:"deonpay-billing-address-line2",type:"text",className:"deonpay-input",placeholder:"Apartamento, suite, etc. (opcional)",value:a.address.line2,onChange:c=>_("address.line2",c.target.value),onBlur:()=>D("address.line2"),autoComplete:"address-line2"})})]})]})};class pe{constructor(e){g(this,"clientSecret");g(this,"appearance");g(this,"locale");g(this,"elements",new Map);this.clientSecret=e.clientSecret,this.appearance=e.appearance||{},this.locale=e.locale||"es"}create(e,t){if(e==="payment"){const s=new Ee(this,t);return this.elements.set(s.id,s),s}else if(e==="billing"){const s=new Le(this,t);return this.elements.set(s.id,s),s}else throw new Error(`Unsupported element type: ${e}`)}getClientSecret(){return this.clientSecret}getAppearance(){return this.appearance}getLocale(){return this.locale}getElements(){return Array.from(this.elements.values())}async submit(){const e=this.getElements();await Promise.all(e.map(t=>{var s;return(s=t.submit)==null?void 0:s.call(t)}))}}class Ee{constructor(e,t={}){g(this,"id");g(this,"type","payment");g(this,"elements");g(this,"options");g(this,"container",null);g(this,"root",null);g(this,"eventHandlers",new Map);this.id=`payment-element-${Math.random().toString(36).substr(2,9)}`,this.elements=e,this.options=t}mount(e){if(this.container)throw new Error("Element already mounted");const t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error(`Element not found: ${e}`);this.container=t,this.render()}unmount(){if(this.root){try{this.root.unmount()}catch{}this.root=null}this.container&&(this.container=null)}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){var s;(s=this.eventHandlers.get(e))==null||s.delete(t)}emit(e,t){var s;(s=this.eventHandlers.get(e))==null||s.forEach(n=>n(t))}render(){var s;if(!this.container)return;this.container.classList.add("deonpay-elements");const e=this.elements.getAppearance().theme;e&&e!=="none"&&this.container.setAttribute("data-theme",e);const t=this.elements.getAppearance().variables;t&&Object.entries(t).forEach(([n,l])=>{const o=`--dp-${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`;this.container.style.setProperty(o,l)}),this.root=ce.createRoot(this.container),this.root.render(r.jsx(me,{onChange:n=>this.emit("change",n),onReady:()=>this.emit("ready",{}),options:{showCardholderName:((s=this.options.fields)==null?void 0:s.billingDetails)!=="never"},appearance:this.elements.getAppearance()}))}getCardData(){if(!this.container)return null;const e=this.container.querySelector("#deonpay-card-number"),t=this.container.querySelector("#deonpay-expiry"),s=this.container.querySelector("#deonpay-cvv"),n=this.container.querySelector("#deonpay-cardholder-name");if(!e||!t||!s)return null;const l=e.value.replace(/\s/g,""),o=t.value.split("/"),a=s.value,m=n==null?void 0:n.value;return{number:l,exp_month:parseInt(o[0],10),exp_year:parseInt(o[1],10)+2e3,cvv:a,cardholder_name:m}}async submit(){if(!this.container)throw new Error("Element not mounted");this.container.querySelectorAll("input").forEach(t=>{t.dispatchEvent(new Event("blur",{bubbles:!0}))})}}class Le{constructor(e,t={}){g(this,"id");g(this,"type","billing");g(this,"elements");g(this,"options");g(this,"container",null);g(this,"root",null);g(this,"eventHandlers",new Map);this.id=`billing-element-${Math.random().toString(36).substr(2,9)}`,this.elements=e,this.options=t}mount(e){if(this.container)throw new Error("Element already mounted");const t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error(`Element not found: ${e}`);this.container=t,this.render()}unmount(){if(this.root){try{this.root.unmount()}catch{}this.root=null}this.container&&(this.container=null)}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){var s;(s=this.eventHandlers.get(e))==null||s.delete(t)}emit(e,t){var s;(s=this.eventHandlers.get(e))==null||s.forEach(n=>n(t))}render(){if(!this.container)return;this.container.classList.add("deonpay-elements");const e=this.elements.getAppearance().theme;e&&e!=="none"&&this.container.setAttribute("data-theme",e);const t=this.elements.getAppearance().variables;t&&Object.entries(t).forEach(([s,n])=>{const l=`--dp-${s.replace(/([A-Z])/g,"-$1").toLowerCase()}`;this.container.style.setProperty(l,n)}),this.root=ce.createRoot(this.container),this.root.render(r.jsx(Ce,{onChange:s=>this.emit("change",s),onReady:()=>this.emit("ready",{}),options:this.options,appearance:this.elements.getAppearance()}))}getBillingData(){if(!this.container)return null;const e=this.container.querySelector("#deonpay-billing-name"),t=this.container.querySelector("#deonpay-billing-email"),s=this.container.querySelector("#deonpay-billing-phone"),n=this.container.querySelector("#deonpay-billing-address-line1"),l=this.container.querySelector("#deonpay-billing-address-line2"),o=this.container.querySelector("#deonpay-billing-city"),a=this.container.querySelector("#deonpay-billing-state"),m=this.container.querySelector("#deonpay-billing-postal-code"),p=this.container.querySelector("#deonpay-billing-country");return{name:(e==null?void 0:e.value)||void 0,email:(t==null?void 0:t.value)||void 0,phone:(s==null?void 0:s.value)||void 0,address:{line1:(n==null?void 0:n.value)||void 0,line2:(l==null?void 0:l.value)||void 0,city:(o==null?void 0:o.value)||void 0,state:(a==null?void 0:a.value)||void 0,postal_code:(m==null?void 0:m.value)||void 0,country:(p==null?void 0:p.value)||void 0}}}async submit(){if(!this.container)throw new Error("Element not mounted");this.container.querySelectorAll("input, select").forEach(t=>{t.dispatchEvent(new Event("blur",{bubbles:!0}))})}}class Se{constructor(e,t="https://api.deonpay.mx"){g(this,"apiUrl");g(this,"publicKey");this.publicKey=e,this.apiUrl=t}async createToken(e){const t=`${this.apiUrl}/api/v1/elements/tokens`,s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify(e)}),n=await s.json();if(!s.ok){const l=n.error||{message:"Failed to create token"};throw new Error(l.message)}return n.token}}class ye{constructor(e,t={}){g(this,"publicKey");g(this,"config");g(this,"tokenAPI");if(!e)throw new Error("DeonPay: publicKey is required");if(!e.startsWith("pk_"))throw new Error('DeonPay: Invalid public key format. Must start with "pk_"');this.publicKey=e,this.config={apiUrl:t.apiUrl||"https://api.deonpay.mx",locale:t.locale||"es"},this.tokenAPI=new Se(this.publicKey,this.config.apiUrl)}elements(e){if(!e.clientSecret)throw new Error("DeonPay: clientSecret is required");return new pe({...e,locale:e.locale||this.config.locale})}async confirmPayment(e){var l,o;const{elements:t,confirmParams:s,redirect:n="if_required"}=e;try{const a=t.getElements(),m=a.find(d=>d.type==="payment"),p=a.find(d=>d.type==="billing");if(!m)throw new Error("No payment element found");await t.submit();const y=m.getCardData();if(!y||!y.number||!y.exp_month||!y.exp_year||!y.cvv)throw new Error("Información de la tarjeta incompleta");let j;if(p){const d=p.getBillingData();d&&(j={name:d.name||y.cardholder_name||void 0,email:d.email||void 0,phone:d.phone||void 0,address:d.address||void 0})}else y.cardholder_name&&(j={name:y.cardholder_name});const C=await this.tokenAPI.createToken({card:{number:y.number,exp_month:y.exp_month,exp_year:y.exp_year,cvv:y.cvv},billing_details:j}),E=t.getClientSecret(),x=this.extractPaymentIntentId(E),h=await this.confirmPaymentIntentWithToken(x,C.id,j,s==null?void 0:s.return_url);if(h.status==="requires_action"&&h.next_action){if(n==="if_required"){const d=(l=h.next_action.redirect_to_url)==null?void 0:l.url;if(d)try{const u=await this.handle3DSChallenge(d);return{paymentIntent:await this.completeAuthentication(x,u.PaRes,u.MD)}}catch(u){return{error:{type:"authentication_error",message:u.message||"3DS authentication failed"}}}}else if(n==="always"){const d=(o=h.next_action.redirect_to_url)==null?void 0:o.url;d&&(window.location.href=d)}}return{paymentIntent:h}}catch(a){return{error:{type:"api_error",message:a.message||"Failed to confirm payment"}}}}async confirmPaymentIntentWithToken(e,t,s,n){var m;const l=`${this.config.apiUrl}/api/v1/payment_intents/${e}/confirm`,o=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify({payment_method:t,billing_details:s,return_url:n})}),a=await o.json();if(!o.ok)throw new Error(((m=a.error)==null?void 0:m.message)||"Failed to confirm payment");return a}extractPaymentIntentId(e){const t=e.split("_secret_");if(t.length!==2)throw new Error("Invalid client secret format");return t[0]}async handle3DSChallenge(e){return new Promise((t,s)=>{const n=document.createElement("div");n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999999;
      `;const l=document.createElement("div");l.style.cssText=`
        background: white;
        border-radius: 8px;
        padding: 20px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow: hidden;
        position: relative;
      `;const o=document.createElement("button");o.textContent="×",o.style.cssText=`
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        z-index: 1;
      `,o.onclick=()=>{document.body.removeChild(n),s(new Error("3DS authentication cancelled by user"))};const a=document.createElement("iframe");a.src=e,a.style.cssText=`
        width: 100%;
        height: 500px;
        border: none;
        border-radius: 4px;
      `;const m=p=>{p.data&&p.data.type==="3ds_complete"&&(window.removeEventListener("message",m),document.body.removeChild(n),t({PaRes:p.data.PaRes,MD:p.data.MD}))};window.addEventListener("message",m),a.addEventListener("load",()=>{var p;try{const y=a.contentDocument||((p=a.contentWindow)==null?void 0:p.document);if(y){const j=y.querySelector('input[name="PaRes"]'),C=y.querySelector('input[name="MD"]');j&&j.value&&(window.removeEventListener("message",m),document.body.removeChild(n),t({PaRes:j.value,MD:C==null?void 0:C.value}))}}catch{}}),l.appendChild(o),l.appendChild(a),n.appendChild(l),document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&(window.removeEventListener("message",m),document.body.removeChild(n),s(new Error("3DS authentication timed out")))},5*60*1e3)})}async completeAuthentication(e,t,s){var a;const n=`${this.config.apiUrl}/api/v1/payment_intents/${e}/complete_authentication`,l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publicKey}`},body:JSON.stringify({authentication_result:t,MD:s})}),o=await l.json();if(!l.ok)throw new Error(((a=o.error)==null?void 0:a.message)||"Failed to complete authentication");return o}getPublicKey(){return this.publicKey}getConfig(){return this.config}}function ge(i,e){return new ye(i,e)}exports.CardBrandIcon=ue;exports.DeonPay=ge;exports.DeonPayClass=ye;exports.Elements=pe;exports.PaymentCard=me;exports.default=ge;
//# sourceMappingURL=index.js.map
